{% extends "wiki/base.html" %}
{% load static %}
{% load markdown_converter %}
{% block content %}
    <link rel="stylesheet" href="{% static 'css/wiki-page.css' %}">
    <div class="px-4 py-4 my-4 align-middle hero">
        <div class="container align-middle">
            <div class="row">
                <p></p>
                {% if user_detail.1 == None %}
                    {% if content.verified %}
                        <p class="text-muted" data-aos="fade-up" data-aos-duration="600"><img src="{% static 'img/default.jpeg' %}" alt="Deleted User" width="32" height="32" class="rounded-circle hvr-icon"> Deleted User <i class="fas fa-check-circle verified-circle icon-menu hvr-icon"></i></p>
                    {% else %}
                        <p class="text-muted" data-aos="fade-up" data-aos-duration="600"><img src="{% static 'img/default.jpeg' %}" alt="Deleted User" width="32" height="32" class="rounded-circle hvr-icon"> Deleted User </p>
                    {% endif %}
                {% else %}
                    {% if content.verified %}
                        <div data-aos="fade-up" data-aos-duration="700"><a href="{% url "profile" user_detail.1.id %}" class="hvr-picture-bounce text-decoration-none spacing-hover"><p class="text-muted"><img src="{{ user_detail.1.profile.image.url }}" alt="{{ user_detail.1.username }}" width="32" height="32" class="rounded-circle hvr-icon" style="transition: 0.2s"> {{ user_detail.1.username }} <i class="fas hvr-icon fa-check-circle icon-menu"></i></p></a></div>
                    {% else %}
                        <div data-aos="fade-up" data-aos-duration="700"><a href="{% url "profile" user_detail.1.id %}" class="hvr-picture-bounce text-decoration-none spacing-hover"><p class="text-muted"><img src="{{ user_detail.1.profile.image.url }}" alt="{{ user_detail.1.username }}" width="32" height="32" class="rounded-circle hvr-icon" style="transition: 0.2s"> {{ user_detail.1.username }}</p></a></div>
                    {% endif %}
                {% endif %}

                <div data-aos="fade-up" data-aos-duration="800"><h1 class="display-5 fw-bold">{{ content.name }}</h1></div>
                <p data-aos="fade-up" data-aos-duration="800">{{ content.description }}</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            {% if user.is_authenticated %}
            <div class="col-sm-2 hvr-icon-bounce">
                <p data-aos="fade-up" data-aos-duration="900"><a class="text-decoration-none text-center spacing-hover-short" href="{% url "edit_wiki" content.slug %}"><i class="fas fa-edit icon-menu hvr-icon"></i> Edit This Page</a></p>
            </div>
            <div class="col-sm-2 hvr-icon-bounce">
                <p data-aos="fade-up" data-aos-duration="950"><a class="text-decoration-none text-center spacing-hover-short" href="{% url "add_subpage" content.slug %}"><i class="fas fa-file icon-menu hvr-icon"></i> Add new subpage</a></p>
            </div>
            {% endif %}
            <div class="col-sm-2 hvr-icon-bounce">
                <p data-aos="fade-up" data-aos-duration="1000"><a class="text-decoration-none text-center spacing-hover-short" target="_blank" href="#"><i class="fas fa-download icon-menu hvr-icon"></i> Download</a></p>
            </div>
        </div>
        <div class="row">
             {% if messages %}
                {% for message in messages %}
                    {% if message.tags == "success"%}
                        <div class="alert alert-success raleway-font">
                            <i class="fas fa-check"></i> {{ message }}
                        </div>
                    {% endif %}
                    {% if message.tags == "error"%}
                        <div class="alert alert-danger raleway-font">
                            <i class="fas fa-times"></i> {{ message }}
                        </div>
                    {% endif %}
                {% endfor %}
              {% endif %}
        </div>
        <div class="row" id="last-edit">
            {% if user_detail.2 == None %}
            <p class="text-muted" data-aos="fade-up" data-aos-duration="1000">Last edited by <img src="{% static 'img/default.jpeg'%}" alt="Deleted User" width="32" height="32" class="rounded-circle hvr-icon"> Deleted User at {{ content.last_edited_at|date:"F j, Y h:i A" }} UTC</p>
            {% else %}
            <p class="text-muted" data-aos="fade-up" data-aos-duration="1000">Last edited by <a href="{% url "profile" user_detail.2.id %}" class="hvr-picture-bounce text-decoration-none spacing-hover"><img src="{{ user_detail.2.profile.image.url }}" alt="{{ user_detail.2.username }}" width="32" height="32" class="rounded-circle hvr-icon"> {{ user_detail.2.username }}</a> at {{ content.last_edited_at|date:"F j, Y h:i A" }} UTC</p>
            {% endif %}
        </div>
        <div class="row">
            <div class="accordion" id="subpage-index">
                <div class="accordion-item">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="subpage-heading">
                          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#subpageCollapse" aria-expanded="false" aria-controls="subpageCollapse">
                            <i class="fas fa-file-alt"></i> Subpage Index
                          </button>
                        </h2>
                        <div id="subpageCollapse" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                          <div class="accordion-body">

                          </div>
                        </div>
                  </div>
              </div>
            </div>
        </div>
        <p></p>
        <div class="row">
            <div class="col-sm-9" id="wiki">
                {{ content.content | convert_markdown | safe }}
                <p></p>
            </div>
            <div class="col-sm-3 gap-3" id="infobox">
                <div class="row rounded info-box">
                    <img src="{{ content.logo.url }}" alt="{{ content.name }} logo">
                    <h2 class="text-center">{{ content.name }}</h2>
                    <dl class="row">
                        <dt class="col-sm-5 info-box-head">Creator</dt>
                        <dd class="col-sm-7">
                            {% if user_detail.1 == None %}
                            {% if content.verified %}
                                <p class="text-muted"><img src="{% static 'img/default.jpeg' %}" alt="Deleted User" width="32" height="32" class="rounded-circle hvr-icon"> Deleted User <i class="fas fa-check-circle verified-circle icon-menu hvr-icon"></i></p>
                            {% else %}
                                <p class="text-muted"><img src="{% static 'img/default.jpeg' %}" alt="Deleted User" width="32" height="32" class="rounded-circle hvr-icon"> Deleted User </p>
                            {% endif %}
                            {% else %}
                            {% if content.verified %}
                                <a href="{% url "profile" user_detail.1.id %}" class="hvr-picture-bounce text-decoration-none spacing-hover"><p class="text-muted"><img src="{{ user_detail.1.profile.image.url }}" alt="{{ user_detail.1.username }}" width="32" height="32" class="rounded-circle hvr-icon" style="transition: 0.2s"> {{ user_detail.1.username }} <i class="fas hvr-icon fa-check-circle icon-menu"></i></p></a>
                            {% else %}
                                <a href="{% url "profile" user_detail.1.id %}" class="hvr-picture-bounce text-decoration-none spacing-hover"><p class="text-muted"><img src="{{ user_detail.1.profile.image.url }}" alt="{{ user_detail.1.username }}" width="32" height="32" class="rounded-circle hvr-icon" style="transition: 0.2s"> {{ user_detail.1.username }}</p></a>
                            {% endif %}
                            {% endif %}
                    </dl>
                </div>
                <p></p>
                <div class="row">
<!--                    TODO: Pop up box for support creator-->
                    {% if source_type == "github" %}
                        <p><a class="text-decoration-none text-center spacing-hover-short hvr-icon-bounce" target="_blank" href="{{ content.source }}"><i class="fa fa-github icon-menu hvr-icon"></i> GitHub Repositories</a></p>
                    {% elif source_type == "patreon"%}
                        <p><a class="text-decoration-none text-center spacing-hover-short hvr-icon-bounce" target="_blank" href="{{ content.source }}"><i class="fab fa-patreon icon-menu hvr-icon"></i> Get from Patreon</a></p>
                    {% else %}
                        <p><a class="text-decoration-none text-center spacing-hover-short hvr-icon-bounce" target="_blank" href="{{ content.source }}"><i class="fas fa-external-link-square-alt icon-menu hvr-icon"></i> Ruleset Source</a></p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block js %}
    <script src="{% static 'js/wiki.js' %}"></script>
{% endblock %}